---
layout: post
author: Bob Guo
title: Ryzen & Shine
subtitle: 惠普Probook 645 G4工程样评测兼Zen架构工程样品处理器分析
date: 2020-11-2
tags: 惠普 捡垃圾 Probook 笔记本 锐龙
published: true #write true to publish this article.
---
首先，标题这句话是照抄LinusTechTips的锐龙评测的。我很诚实。  
其次，我之前确实说过再装锐龙我是傻逼，很好，我是傻逼。  
最后，工程样机有风险，入坑之前请谨慎。  
好，现在开始
## 缘起
好吧，倒也没啥可以缘起的。之前用的笔记本ThinkPad T430屏幕太烂、平板Latitude 5175性能太差，都没法承担我主力mobile computing platform的重任，恰巧刷到这个一千块的锐龙本，别的不说，好歹是Zen架构的U，虽然不敌现在新架构但打打我之前用的35w Ivy Bridge和4.5w Skylake总没问题吧？PD充电能直接导入我的移动设备生态、支持双通道DDR4、NVMe固态硬盘和标准2.5寸SATA硬盘完美利用我这边剩下的边角料（虽然还是找本地LUG的老哥买了个960 EVO），还有爷最爱的指点杆，买了买了（笑）  
其实我本来想买GS30的，那台机器是我个人觉得pre ryzen days最有意思的机器之一，通过直接引出PCIe达到性能和便携性的完美平衡，不仅在GPU性能上不用卡死在一代机器上，还能够直接使用包括P106在内的各种PCIe拓展卡，直接提升了机器综合的可玩性，不过在咸鱼上没找到好机器就此作罢，加上又买了一套锐龙ES平台，于是最后就定下来这台机器了。  
## 配置、外观、拓展 and everything
### 外观
![alt text](/img/645g4/top.jpg)
![alt text](/img/645g4/display.jpg)
![alt text](/img/645g4/keyboard.jpg)
![alt text](/img/645g4/bottom.jpg)
典型的惠普商务本设计风格，这种风格从早年Elitebook开始就没怎么变动，作为一个怀旧的人，我表示爱了爱了。不过有一说一不吹不黑纯路人，这个屏幕边框是真的离谱。
![alt text](/img/645g4/front.jpg)
背部有写PROBOOK，曾几何时这是只有坠高端滴Elitebook才有资格享受的高端设计，现在飞入寻常百姓家了
![alt text](/img/645g4/rear.jpg)
这里做的不好，看上去很厚重
### 硬件配置

我这台电脑搭载了一颗AMD Ryzen  7移动处理器，具体型号是：AMD Eng Sample: ZM2000C4T4MF2_36/20_N。根据这份来自[MoePC](http://www.moepc.net/)的[AMD处理器工程样品编号指南](http://www.moepc.net/content/uploadfile/201811/8d7b1542898939.png)，我这颗处理器是一颗已经进入QS阶段的、标称频率2.0Ghz的、属于15w Raven/Picasso -U家族的、使用FP5 BGA接口的、四核心的、4x512K L2+4M L3、B步进的、能加速到3.6Ghz的处理器.鉴于这颗处理器的定位，有理由怀疑它同样搭载了10个AMD RX Vega GPU核，不过似乎由于系统原因radeontop无法正常工作读取数据。由于这台工程机的BIOS是惠普内部RD用的00.87.00版本，无论是Windows还是我常用的Arch Linux都难以正常驱动。根据与最早的卖家的对话，似乎这个vBIOS版本导致了在更新的Linux内核中其GPU无法被驱动访问，导致除Ubuntu 18.04.1和Debian 10之外的所有主流桌面发行版安装镜像都在通过GRUB后黑屏。也还算是运气，我入门就是靠Ubuntu，加上18.04LTS仍然在三年LTS期限内，倒也还不是不能用。至于Windows，无论是Windows Update还是从AMD官网或HP官网下载的驱动都是没法正常工作的，理由同上。而FreeBSD我不会用；强行Hackintosh不仅需要花两百块投资一张十有八九用不上的博通无线网卡，在Zen架构的处理器上运行Darwin内核还需要对内核进行大量的改动，实在是得不偿失。
#### CPU
![alt text](/img/645g4/cpu.png)
Zen架构在2017年可谓是对Intel的当头一棒：以远低于Intel的单位成本提供了相差无几的性能表现，随后的Zen+与Zen2更是将“相差无几”变成了“平起平坐”，而即将到来的Zen3更是在IPC上反超Intel，不过这是后话了。
![alt text](/img/645g4/cpu.jpg)
这颗2700U的ES片基于格罗方德的14nm工艺打造，基于Raven Ridge架构，是Zen架构的APU型号。这颗处理器的标称频率为2.0Ghz，在Precision Boost下可达到3.6Ghz，配合四颗物理核心应对我的需求（Minecraft、文书处理、看视频）绰绰有余。
#### GPU
这颗GPU才是我抛弃所有Intel方案转投Zen的核心原因。由于我需要我的笔记本能够承担一些轻度的多媒体娱乐，基于成熟的GCN架构的Raven Ridge APU虽然性能不如NVIDIA的独立显卡，但对于我的需求来说也已经绰绰有余。在轻薄本上达到1080p60fps的Minecraft体验在Raven Ridge出现之前几乎是不可想象的，而Dr.Lisa Su的传统强项GPU配合高性能的CPU更是如虎添翼。
#### DRAM
![alt text](/img/645g4/ram.jpg)
我使用的内存仍然是上次Latitude E7470时的“Legacy”-两条8GB DDR4 2666内存，组成16GB DDR4 双通道内存。由于这代处理器仅支持2400的速度，虽然内存速度影响GPU性能，但是在不超频的情况下我也没啥办法。SO-DIMM某种意义上作为旧时代的legacy在新式的笔记本中越发少见，似乎所有厂商都开始学习苹果的恶臭操作对用户开刀。诚然，若非我这样的玩家，正常用户在整台设备的生命周期中会更换内存的次数屈指可数，而且SO-DIMM而非BGA设计对设备的厚度也有一定的增加，对于现在笔记本越做越薄的趋势来说是毁灭性的，甚至也有人以可靠性说事，认为全BGA的方案更为可靠。To be fair, they all makes sense，但是我仍然无法接受这种说辞。在我看来，除非是真的需要做到极致轻薄（例如我之前评测过的XPS12与Latitude 5175），否则这种说辞纯粹是厂商为了赚取更多利润而发表的屁话。华为因为其在笔记本领域大量采用2666速率的DDR4内存而被社群厌恶，而如果此时采用的是SO-DIMM方案，无论对于华为还是对于用户来说解决方案都十分简单明了：定一批高速内存，然后自己更换。而且，使用SO-DIMM方案也可以让厂商有更加灵活的SKU，而不用为了提供不同的SKU挤占库存。当然，众所周知，11系Intel处理器的Xe集显需要使用LPDDR4x 4266内存才能达到最佳的效率，这种情况下为了达到最佳的性能我也不反对采用BGA式的内存设计。
#### Storage
![alt text](/img/645g4/storage.jpg)
![alt text](/img/645g4/nvme_front.jpg)
![alt text](/img/645g4/nvme_back.jpg)
这次的机器实现了多盘纯SSD的存储方案：一张三星960 EVO安装Ubuntu 18.04.1操作系统；一张英特尔DC S3500存放测试用文件；一张Lexar 128G TF卡存放视频文件。除了最后一个之外，另外两张盘的质量我不用过多介绍，懂得都懂：三星自家3D TLC颗粒、Intel企业级MLC颗粒的性能配合高质量的主控和DRAM Cache能够保证在我的使用情况下的优秀表现。这台机器仍然支持2.5英寸的SATA硬盘从某种程度上确实令人震惊，毕竟随着NVMe的更大规模普及，这种legacy的form factor在商务本中继续存在的意义有多大实在是存在争议。当然，有总是好的，不过我个人更希望像2014年戴尔XPS15一样提供一个“低容量电池+HDD”和“高容量电池”的选择，这样会是一个更灵活的方案。
#### Internet
![alt text](/img/645g4/wireless.jpg)
这次的机器，作为一台商务本，也有三种网络连接方案：RJ45有线网络、Wi-Fi与LTE。我这台机器本来的有线和无线方案都来自于RealTek，不过后者被我换成了闲置的AC 7260。LTE方案还是传统的SIM卡+NGFF卡，机器也很贴心地提供了所有必要的天线。对于我来说，自始至终我都没有认为基于笔记本的LTE方案对于这种普通商务本有什么存在的必要，即使存在像野外探险这样、需要通过LTE方式传输数据的需求，这台中端商务本也显然不适合处理这种工作。
#### Display
![alt text](/img/645g4/panel.jpg)
这我不得不喷一下惠普的「」团队了。这「」是一台2018年的商务本，传统艺能76845TN就不说了，请问贵司团队如何天才地决定了所有屏幕都是45sRGB（还「」的不是NTSC，更惨）的？坠高贵的FHD触屏也是这种狗屎级别的屏幕，比华硕天选还「」。  
不过有一点好是什么呢？这玩意儿屏幕还算好换，而且用的是30针eDP排线，所以完全可以自己更换质量更高的屏幕。我这台机器就换了一块友达光电的屏幕，型号是B140HAN01.2，满足72%NTSC的一般标准，属于及格的屏幕。
### 接口
这台电脑既然隶属于HP Probook商务本系列，其IO配布自然是实用至上主义。相较于Latitude更传统的蚌壳架构导致分析这台电脑的IO不需要像Latitude那样拍四面图片即可。三个USB3、HDMI、VGA、耳机口、全功能C口、电源、TF卡、千兆网口和拓展坞接口，实在是具有商务本的特性：一切以商务用途为中心：VGA和HDMI保证能够连接主流的投影仪和显示器，Type-C不仅可以配合转接器使用也可以独立输出视频信号与更先进的设备联动；有线网口方便调试配置进入安全网络环境；四个USB接口保证了可以外接多个设备同时进行工作；PD与AC两种充电方式在使用中有更为灵活的电力补充方案。这种灵活的IO在某种意义上也成为了商务本的必备属性，作为一个接口不够用症重度患者，我对这种设计思路是很赞赏的。
### 安全性
既然是商务本就不得不聊到安全性问题了。对于企业用户来说，数据安全自然是重中之重；而商务本的溢价中有一部分就支付给了全套的安全方案。这台电脑的安全方案主要有以下几种：BIOS层面的双校验（HP SureStart）、硬盘加密、智能卡、指纹识别、OS密码。
#### Sure Start
![alt text](/img/645g4/bios.jpg)
HP SureStart技术上就跟技嘉DualBIOS类似，在主板上有两个装载BIOS镜像的芯片，其中一片作为主片另一片作为备片。在开机时，BIOS文件会进行验证，如果BIOS验证出现问题，则备片的文件将会自动覆写主片并提示用户，我也利用这种方法获得了一份00.87.00的BIOS文件。根据试验，发现靠近散热器一侧的芯片为主片，另一片为备片。若不存在备片/备片数据不正确则无法开机，有可能是备片中存在DRM程序。  
![alt text](/img/645g4/bios_chip.jpg)
说到BIOS，有一个地方很离谱。这台工程样机的BIOS芯片使用的是SON-8封装，虽然这保证了一旦出事拿备份文件刷好装上去就能继续用，但购买一个SON8夹子的价格实在是过于离谱。
#### 指纹模块
![alt text](/img/645g4/fingerprint.jpg)
这台电脑上的指纹模块是MicroTips的VFS495，在Linux上支持很麻烦，故不做评价。据说Ubuntu 20.10将会对指纹解锁做官方层面的oob支持，我很期待。
### 拆机
这台机器的拆机与维护还是比较轻松的。![alt text](/img/645g4/internal.jpg)D面的八个十字螺丝卸下之后就能够轻松地接触到所有的用户可维护部件：内存、硬盘、网卡、电池，甚至连BIOS芯片都可以easy access，这对于一般的维护与升级来说十分方便。
![alt text](/img/645g4/shell.jpg)  
而包括散热器在内的其他部件全部被包裹在黑色塑料制成的夹层里，保护作用暂且不提但从观感上就给人一种设计师有考虑过use case的感觉，而且这样的设计也能有效降低终端用户升级时搞出事情的概率。主板本身就是极其精密的部件，而笔记本主板这种将几乎所有组件都焊接上去的板子更是精密至极，任何一个小的电容损坏都可能导致机器的彻底报废（我真的报废过），这时这样一块夹层也确实能够有效地减少出故障的可能性。不过，由于定位原因，这种设计无法保证在维护时异物不会落入主板，而一旦一个导电的或者尖锐的异物落入主板，则一切休矣。 
![alt text](/img/645g4/mb_f.jpg)
![alt text](/img/645g4/mb_r.jpg)
![alt text](/img/645g4/db_f.jpg)
![alt text](/img/645g4/db_r.jpg)
## 测试
由于硬件限制，本次测试中所有方面都来自Ubuntu 18.04LTS操作系统，内核版本4.15.0-29，开发代号Bionic Beaver。![alt text](/img/645g4/neofetch.jpg)这个版本是在目前的环境下唯一可用的版本，而且我无法通过主流技术手段获取实时功耗等数据。所以，这次评测的测试内容将会以在给定使用场景下的体验为主。测试列表如下：

### 生产力测试
#### Linux内核编译
在今天（2020年11月1日）从TUNA下载的Linux源码，使用ssh远程连接到没有打开任何非必要应用程序的、运行KDE Plasma的主机，使用默认config文件，以正常的姿势摆放笔记本电脑，make -j8编译总时长55分27秒。
![alt text](/img/645g4/kernel_time.png)  
编译时所有核心运行在1.3Ghz，温度70摄氏度，判定已经触及功耗墙，目测15w L2。
![alt text](/img/645g4/htui_kernel.png)
与我上一台评测的传统蚌壳本Latitude E7470一样的15w L2，但是那台电脑搭载的是双核Skylake 6300U，这15w只需分给两个CPU核心，而这颗四核Raven Ridge “2700U”需要均分给四个CPU核心，虽然确实无法在使用中出现明显的瓶颈，但有一说一，我个人认为这个功耗不足以喂饱这种高性能处理器。当然，这也有可能是因为早期版本的BIOS并未对功耗进行深度调教，但这点我目前暂时没有条件验证。不过，即使有，在不变动物理散热模组的设计与用料之前，我个人对深度调教能带来的结果保持悲观。
#### UnixBench
采用UnixBench 5.1.3源码进行测试，在进行单核心项目测试时可以发现核心速度飙上3Ghz，此时温度高达77摄氏度，似乎功耗墙和温度墙同时生效。![alt text](/img/645g4/unixbench_sc.png)  
这种双重设计对于这台笔记本的设计定位来说还是比较合理的。测试结果单核1527.4分多核3256.4分，这样的数据并不符合物理核心的数量差，但通过仔细阅读[报告](/bench/645g4/unixbench.html)，发现在*File Copy 1024 bufsize 2000 maxblocks*、*File Copy 256 bufsize 500 maxblocks*与*File Copy 4096 bufsize 8000 maxblocks*三个测试项目中，单核成绩都远远超出多核心版本。个人怀疑这是因为这套程序并未对Ryzen系列处理器进行优化导致，但目前暂时也没有条件尝试排除问题根源。
### 多媒体测试
#### VLC播放视频
因为这台CPU搭载了一颗高性能的Radeon Vega 10核芯显卡，之前近乎不可能的4K视频测试也可以正常完成。测试使用三个不同规格的素材：
1. VCB Studio封装的《天气之子》4K版蓝光盘，10bit HDR HEVC+FLAC，我之前测试的所有笔记本都在这个项目上被迫GG，这次的Radeon Vega核芯显卡可否绝杀比赛呢？
![alt text](/img/645g4/vcb4K.png)
![alt text](/img/645g4/vcb4K_play.png)
事实证明，Vega 10并非浪得虚名。应对这种高码率的4K视频毫无压力，完全能够流畅播放，拖动也十分流畅。这台电脑完全可以作为一台4K视频主机使用。
2. B站4K视频，具体来说是刚刚发布的[STN快报第五季第16集](https://www.bilibili.com/video/BV1ST4y1F71P)的HDR版本。由于我国特殊国情，B站的4K视频更多时候是空有4K的皮囊，其清晰度甚至不如高码率的FHD视频。不过，毕竟还是物理4KHDR，还是有一定挑战意义在的。
![alt text](/img/645g4/bili4K.png)
![alt text](/img/645g4/bili4Kvlc.png)
![alt text](/img/645g4/bili4Kmpl.png)
不过，可能是由于它采用了特殊的HDR封装，VLC直接宕机无法播放，使用mplayer出现了严重的音画不同步现象。鉴于B站HDR视频需要使用基于EdgeHTML内核的老Edge才能播放，有理由怀疑其采用的编码器并没有被默认安装。
3. VCB Studio封装的《利兹与青鸟》FHD蓝光盘。这部电影不多说了吧？京阿尼永远滴神。我个人认为在《凉宫春日的消失》之外最佳的京阿尼剧场版动画就是这个了，这个时候就需要研究一下[《北宇治高中吹奏乐部止步关西如何问责》](https://hibikilogy.github.io/2020/01/10/ruhewenze/)了（笑）
![alt text](/img/645g4/vcbFHD.png)
![alt text](/img/645g4/vcbFHD_play.png)
既然4K蓝光都没有问题，那么这部分内容自然也不在话下。可惜的是，如果没有更换屏幕，机器的默认屏幕并无法承担这种高画质内容的欣赏，这不得不说是一个遗憾。
#### Minecraft 1.15.2
Minecraft这个游戏是没有性能上限的，虽然我玩的版本是最普通最普通什么buff都没有的原版，但是在这台机器上还是能够体现性能差距的。为什么1.15.2？我玩的服务器还没有升级到更新版本嘛这不是w  
![alt text](/img/645g4/mc_ser.png)
![alt text](/img/645g4/mc_game.png)
最高画质下全屏，在刚开始游戏的时候还略有一点小卡但马上会稳定在60帧的、极其流畅的体验。
#### CSS测试
图一乐的测试。
![alt text](/img/645g4/csgo_set.png)
![alt text](/img/645g4/csgo_result.png)
## 总结
这次评测由于时间原因并没有写得很完善，包括BIOS问题在内的一大批问题都导致了这篇文章内容比较缺乏。不过，我个人认为单纯用作解析这台笔记本电脑的也已经足够。这台笔记本在设计方面有很多巧思，例如D壳与主板之间的夹层，但是在SKU上也有很多神奇的问题，比如全线45sRGB这种奇妙深刻的设计。初代Zen架构APU-Raven Ridge U的性能表现在15w的TDP限制下已经足够亮眼，搭载Radeon Vega核芯显卡（虽然是GCN架构）使其的多媒体性能较之于友商竞品更为强悍，若是给予更宽松的限制，其表现如何令人期待。有一说一，我个人真的不喜欢在轻薄本里额外增加一套GPU芯片，在这个环境下高性能的核显远比游戏卡下放来的更有意义。MX450这张卡更应该是作为普通轻薄本和游戏本\CC本之间的一个中介卡而存在，不过各人需求不同吧。Radeon核显的解决方案在我眼里比外接独显优雅许多，更适合一台商务取向的轻薄本。但是话又说回来，有APU+独显的轻薄本嘛？  
不过，现在2020年都已经接近尾声，轻薄本图形市场的御三家都提出了表现优异的方案。Intel Xe架构显卡这支新兴势力、NVIDIA MX450下放GTX1650核心这支老牌劲旅，对于AMD来说，这两支势力都不容小觑。不仅如此，还有曾经在移动端攻城略地的ARM Mali和Qualcomm Aderno，甚至苹果自家的GPU也对桌面市场虎视眈眈。这样的多强争霸，对于我们消费者和玩家来说实在是大利好。几年前你要是跟我说五千左右的普通轻薄本可以搭载GTX 50级别的显卡核心、AMD反杀Intel、Intel核芯显卡能与老黄打擂台，我一定会觉得你在开玩笑，但是可笑的是，这就是我们所面对的现实。2017年横空出世的Ryzen打响了AMD反攻的第一炮，也引发了这几年个人PC市场的大混战，作为一个没有经历过九十年代黄金时期的零零后，我亲眼目睹了AMD从爱好者口中颇有调侃性质的人智农一跃成为When in doubt AMD的高性价比选择。只有竞争才会带来优秀的产品，这一点是毋庸置疑的。用户要做的，就是用自己的钞票去支持优秀的产品，并且通过各种渠道告诉厂商我们想要什么。